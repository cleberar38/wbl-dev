var wbl={core:{},event:$("<div />"),copyright:"Â© 2014 WBL"};
wbl.core.Div=L.Class.extend({initialize:function(){this.parentTag=$("body"),this.draw()},draw:function(){var i=$("#mapdiv");if(!i.length){var i=$('<div id="mapdiv" class="mapdiv" />'),n=$('<div id="maindiv" class="maindiv" />');n.append(i),this.parentTag.append(n)}L.Browser.touch&&$(window).on("orientationchange",function(){window.scrollTo(0,0)}),wbl.event.on("wbl.core.pluginsadded",function(){var i=utils.getBrowser();i.ie&&i.ieVersion<=8})},CLASS_NAME:"wbl.core.Div"});
wbl.core.Init=L.Class.extend({options:{},initialize:function(){this.defineProjs(),wbl.core.divInstance=new wbl.core.Div,this.init()},defineProjs:function(){window.proj4&&(proj4=window.proj4,proj4.defs([["EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"],["EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"],["EPSG:3008","+proj=tmerc +lat_0=0 +lon_0=13.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3021","+proj=tmerc +lat_0=0 +lon_0=15.8062845294444 +k=1.00000561024+x_0=1500064.274 +y_0=-667.711 +ellps=GRS80 +units=m"]]))},init:function(n){n=n||{};this.drawMap(),wbl.core.layerInstance=new wbl.core.Layer(this.map),wbl.core.pluginHandlerInstance=new wbl.core.PluginsHandler(this.map),wbl.config=window.config?window.config:config||{},wbl.core.pluginHandlerInstance.addPlugins(window.config.plugins)},drawMap:function(n){n=n||{};var i=$.extend({},n);this.map=L.map("mapdiv",i),wbl.map=this.map},CLASS_NAME:"wbl.core.Init"});
wbl.core.Layer=L.Class.extend({options:{},_layers:{},initialize:function(e){this.map=e,this.createLayer()},createLayer:function(){},CLASS_NAME:"wbl.core.Layer"});
wbl.core.Param=L.Class.extend({initialize:function(a){this.map=a},_lang:{sv:{remove:"Ta bort"},en:{remove:"Remove"}},_setLang:function(){langCode=wbl.config.langCode,this._lang&&(this.lang=this._lang?this._lang[langCode]:null)},getParams:function(){var a=this._cachedParams||null;return a||(a=this.getWebParamsAsObject(),wbl.config&&(configParams=wbl.config.params||{},a=$.extend({},utils.objectToUpperCase(configParams),a),this._cachedParams=a)),a},getWebParamsAsObject:function(){var a="?",t=location.href.split(a),e=t.length>1?t[1]:"";return paramsObject=utils.paramsStringToObject(e,!0),paramsObject},createParamsAsObject:function(){var a,t,e,n=this.map.getCenter(),r=this.map._layers,o=[];for(var i in r)t=r[i],t&&t.options&&t.options.layerId&&(e=t.options.layerId,t.options.isBaseLayer?a=e:-1===$.inArray(t.options.layerId,o)&&o.push(e));var s={zoom:this.map.getZoom(),center:[utils.round(n.lng,5),utils.round(n.lat,5)],ol:o,bl:a};return wbl.config.configName&&(s.config=wbl.config.configName),wbl.event.trigger("wbl.core.createparams",s),s},createParams:function(a){a=a||!1;var t,e=this.createParamsAsObject(),n="";for(var r in e){if(t=e[r],t instanceof Array){if(!t.length)continue;t=t.join(",")}n+="&"+r+"="+t}if(n=n.substring(1),a){var o="";a===!0?o=document.URL.split("?")[0]+"?":"string"==typeof a&&(o=a),n=o+n}return n},applyParams:function(a){function t(){$(".wbl-core-btn-popup").on("click",function(){return e.map.removeLayer(g),!1})}a=a||{};var e=this;wbl.event.trigger("wbl.core.beforeapplyparams",a),this._setLang();var n=a.ZOOM?parseInt(a.ZOOM):0,r=a.CENTER?L.latLng([parseFloat(a.CENTER[1]),parseFloat(a.CENTER[0])]):null;if(n||0===n||(n=this.map.options.minZoom||0),r?this.map.setView(r,n,{animate:!1}):this.map.fitWorld(),a.XY){var o=this.getWebParamsAsObject(),i=parseFloat(a.XY[1]),s=parseFloat(a.XY[0]),l=null;if(a.XY.length>2){var p=a.XY[2];if(l="<p>"+p+'</p><button class="btn btn-default wbl-core-btn-popup">'+this.lang.remove+"</button>",a.XY.length>3){var c=a.XY[3];1!=/^EPSG:/.test(c)&&(c="EPSG:"+c);var m=utils.projectPoint(s,i,c,"EPSG:4326");s=m[0],i=m[1]}}var g=L.marker([i,s]);this.map.addLayer(g),o.CENTER||this.map.setView(g.getLatLng(),o.ZOOM||16,{animate:!1}),l&&(this.map.off("popupopen",t).on("popupopen",t),g.bindPopup(l).openPopup())}wbl.event.trigger("wbl.core.applyparams",a)},CLASS_NAME:"wbl.core.Param"});
wbl.core.PluginsHandler=L.Class.extend({initialize:function(n){this.map=n;var t=this;wbl.event.on("wbl.core.pluginsadded",function(){t._processQueue()})},getPlugin:function(){for(var n,t=wbl.core.controls||[],i=0,l=t.length;l>i;i++)if(n=t[i],n instanceof L.Control[controlName])return n;return null},addPlugins:function(arr){var t,init,autoActivates=[];wbl.core.controls=wbl.core.controls||[];for(var i=0,len=arr.length;len>i;i++)t=arr[i],init=eval(t.init),init&&(init=new init(t.options||{}),this.map.addControl(init),wbl.core.controls.push(init),init.options.autoActivate&&autoActivates.push(init));wbl.event.trigger("wbl.core.pluginsadded"),wbl.event.pluginsadded=!0;for(var i=0,len=autoActivates.length;len>i;i++)autoActivates[i].activate()},_callQueue:[],callPlugin:function(n,t,i,l){i=i||[];var e=L.Control[n];wbl.event.pluginsadded?this._callPlugin(e,t,i,l):this._callQueue.push([e,t,i,l])},_callPlugin:function(n,t,i,l){if(!n)return null;for(var e,r=wbl.core.controls||[],o=null,a=0,u=r.length;u>a;a++)if(e=r[a],e instanceof n){o=e[t].apply(e,i||[]);break}return l?l(o):o},_processQueue:function(){var n,t,i,l=this._callQueue||[];for(t=0,len=l.length;t<len;t++)n=l[t],i=this._callPlugin.apply(this,n);return this._callQueue=[],i},CLASS_NAME:"wbl.core.PluginsHandler"});
wbl.core.mainConfig={mapConfig:{layers:[],crs:L.CRS.EPSG3857,attributionControl:!0,zoomControl:!1,maxZoom:18,disabledRightClick:!0},wblOptions:{title:"WBL-DEV",popupAutoPanPadding:[0,70],defaultLanguage:"sv"},toolbarPlugin:"Menu",defaultTheme:"wbl",configFolders:["/configs/"]};
var utils={getBrowser:function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/),i=e?parseInt(e[1]):void 0;return{ie:e,ieVersion:i,ie8:8===i,ie9:9===i,ie10:10===i,ie11:11===i}}};
L.Control.Footer=L.Control.extend({options:{position:"topleft"},_lang:{sv:{},en:{}},initialize:function(n){L.setOptions(this,n),this._setLang(n.lang)},_setLang:function(n){n=n||wbl.config.langCode,this._lang&&(this.lang=this._lang?this._lang[n]:null)},onAdd:function(n){return this._map=n,this._container=L.DomUtil.create("div","leaflet-control-footer"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.control.footer=function(n){return new L.Control.Footer(n)};
L.Control.Header=L.Control.extend({options:{position:"topleft"},_lang:{sv:{},en:{}},initialize:function(n){L.setOptions(this,n),this._setLang(n.lang)},_setLang:function(n){n=n||wbl.config.langCode,this._lang&&(this.lang=this._lang?this._lang[n]:null)},onAdd:function(n){return this._map=n,this._container=L.DomUtil.create("div","leaflet-control-header"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){},createHeader:function(){}}),L.control.header=function(n){return new L.Control.Header(n)};